<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Album</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        // Check authentication (NOT SECURE - client-side only!)
        if (sessionStorage.getItem('photoAlbumAuth') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üì∏ Photo Album</h1>
            <div class="header-controls">
                <span id="userInfo" class="user-info"></span>
                <button id="downloadAlbumBtn" class="btn-download-album">‚¨áÔ∏è Download Album</button>
                <a href="logout.html" class="btn-logout">üîì Logout</a>
            </div>
        </header>

        <!-- Album Selection & Upload Section -->
        <div class="controls-section">
            <div class="album-controls">
                <select id="albumSelect" class="album-select">
                    <option value="">-- W√§hlen Sie ein Album / Select Album --</option>
                </select>
                <button id="newAlbumBtn" class="btn-new-album">+ Neues Album / New Album</button>
                <button id="analyseAlbumBtn" class="btn-analyse-album" style="background: #8b5cf6; color: white;">üîç
                    Analyse Album / Analyse Album</button>
                <button id="deleteAlbumBtn" class="btn-delete-album" style="background: #ef4444; color: white;">üóëÔ∏è
                    Album l√∂schen / Delete Album</button>
            </div>

            <div id="uploadSection" class="upload-section" style="display: none;">
                <h2>Fotos hochladen / Upload Photos</h2>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üì§</div>
                    <p><strong>Klicken Sie oder ziehen Sie Fotos hierher</strong></p>
                    <p><small>Click or drag photos here</small></p>
                    <p><small>Mehrere Dateien werden unterst√ºtzt / Multiple files supported</small></p>
                    <input type="file" id="fileInput" accept="image/*" multiple hidden>
                </div>

                <div id="uploadProgress" class="upload-progress" style="display: none;">
                    <h3>Hochladen... / Uploading...</h3>
                    <div id="progressList"></div>
                </div>
            </div>
        </div>

        <!-- Photo Gallery -->
        <div id="gallerySection" class="gallery-section" style="display: none;">
            <div class="gallery-header">
                <h2 id="albumTitle"></h2>
                <div class="gallery-stats">
                    <span id="photoCount">0 Fotos</span>
                </div>
            </div>
            <div id="photoGrid" class="photo-grid"></div>
        </div>

        <!-- New Album Modal -->
        <div id="newAlbumModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Neues Album erstellen / Create New Album</h2>
                <input type="text" id="newAlbumName" placeholder="Album-Name / Album Name" class="input-album-name">
                <button id="createAlbumBtn" class="btn-create">Erstellen / Create</button>
            </div>
        </div>

        <!-- Analysis Results Modal -->
        <div id="analysisModal" class="modal">
            <div class="modal-content modal-large">
                <span class="close" id="closeAnalysisModal">&times;</span>
                <h2>üîç Album Analysis Results</h2>

                <div id="analysisProgress" style="display: none;">
                    <div class="analysis-spinner">Analyzing images...</div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" id="analysisProgressBar" style="width: 0%"></div>
                    </div>
                </div>

                <div id="analysisResults" style="display: none;">
                    <div class="analysis-summary">
                        <div class="summary-item">
                            <strong id="duplicatesCount">0</strong>
                            <span>Duplicates</span>
                        </div>
                        <div class="summary-item">
                            <strong id="blurryCount">0</strong>
                            <span>Blurry</span>
                        </div>
                        <div class="summary-item">
                            <strong id="lowQualityCount">0</strong>
                            <span>Low Quality</span>
                        </div>
                        <div class="summary-item">
                            <strong id="totalIssuesCount">0</strong>
                            <span>Total Issues</span>
                        </div>
                    </div>

                    <div class="bulk-actions">
                        <button id="selectAllIssues" class="btn-select-all">‚úì Select All Issues</button>
                        <button id="bulkDeleteSelected" class="btn-bulk-delete"
                            style="background: #ef4444; color: white;">
                            üóëÔ∏è Delete Selected (<span id="selectedCount">0</span>)
                        </button>
                    </div>

                    <div id="issuesList" class="issues-list">
                        <!-- Issues will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Photo Lightbox -->
        <div id="lightbox" class="lightbox">
            <span class="close-lightbox">&times;</span>
            <img id="lightboxImg" src="" alt="">
            <div class="lightbox-caption" id="lightboxCaption"></div>
        </div>
    </div>

    <!-- Cloudinary Upload Widget Script -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>

    <!-- Configuration -->
    <script src="config.js"></script>
    <script src="config.local.js"></script>

    <!-- Album Analysis Module -->
    <script type="module" src="album-analysis.js"></script>

    <!-- GitHub Gist Sync App -->
    <script type="module" src="app-gist-sync.js"></script>

    <script>
        // Display logged in user
        const user = sessionStorage.getItem('photoAlbumUser') || 'User';
        document.getElementById('userInfo').textContent = 'üë§ ' + user;
    </script>
</body>

</html>