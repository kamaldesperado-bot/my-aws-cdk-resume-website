#!/bin/bash
# Travel Bot Environment Variables Setup

echo "ðŸŒ Travel Bot Environment Setup"
echo "================================"

# OpenWeather API Key (Required for weather features)
echo "1. OpenWeather API Key:"
echo "   Visit: https://openweathermap.org/api"
echo "   Sign up (free) and get your API key"
read -p "   Enter your OpenWeather API key: " OPENWEATHER_KEY
export OPENWEATHER_API_KEY="$OPENWEATHER_KEY"

# Google Credentials (Optional - for enhanced conversation)
echo ""
echo "2. Google Dialogflow (Optional):"
echo "   Visit: https://console.cloud.google.com"
echo "   Create service account and download JSON"
read -p "   Enter path to Google credentials JSON file (or press Enter to skip): " GOOGLE_CREDS_PATH
if [ ! -z "$GOOGLE_CREDS_PATH" ] && [ -f "$GOOGLE_CREDS_PATH" ]; then
    export GOOGLE_CREDENTIALS=$(cat "$GOOGLE_CREDS_PATH")
    echo "   âœ… Google credentials loaded"
else
    export GOOGLE_CREDENTIALS=""
    echo "   â­ï¸  Skipping Google Dialogflow (will use fallback)"
fi

# Azure Text Analytics (Optional - for sentiment analysis)
echo ""
echo "3. Azure Text Analytics (Optional):"
echo "   Visit: https://portal.azure.com"
echo "   Create Language resource (free tier available)"
read -p "   Enter Azure Text Analytics key (or press Enter to skip): " AZURE_KEY
read -p "   Enter Azure endpoint (or press Enter to skip): " AZURE_ENDPOINT
export AZURE_TEXT_ANALYTICS_KEY="$AZURE_KEY"
export AZURE_TEXT_ANALYTICS_ENDPOINT="$AZURE_ENDPOINT"

# AWS Lex (Optional - uses fallback intent recognition)
echo ""
echo "4. AWS Lex Bot (Optional):"
echo "   Visit: AWS Console > Amazon Lex"
read -p "   Enter Lex Bot ID (or press Enter to skip): " LEX_BOT
read -p "   Enter Lex Bot Alias ID (or press Enter for default): " LEX_ALIAS
export LEX_BOT_ID="${LEX_BOT:-YOUR_LEX_BOT_ID}"
export LEX_BOT_ALIAS_ID="${LEX_ALIAS:-TSTALIASID}"

# Save to .env file
echo ""
echo "ðŸ’¾ Saving environment variables to .env file..."
cat > .env << EOF
# Travel Bot Environment Variables
OPENWEATHER_API_KEY="$OPENWEATHER_API_KEY"
GOOGLE_CREDENTIALS='$GOOGLE_CREDENTIALS'
AZURE_TEXT_ANALYTICS_KEY="$AZURE_TEXT_ANALYTICS_KEY"
AZURE_TEXT_ANALYTICS_ENDPOINT="$AZURE_TEXT_ANALYTICS_ENDPOINT"
LEX_BOT_ID="$LEX_BOT_ID"
LEX_BOT_ALIAS_ID="$LEX_BOT_ALIAS_ID"
EOF

echo "âœ… Environment setup complete!"
echo ""
echo "ðŸ“‹ Next steps:"
echo "   1. source .env"
echo "   2. npm run build && cdk deploy TravelBotStack"
echo ""
echo "ðŸš€ Your travel bot will work with just OpenWeather API key!"
echo "   Other services provide enhanced features but have fallbacks."